using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Models.App_Data;

namespace Models
{
    public class Exploitation
    {
        AgricultureEntities entities = new AgricultureEntities();
        public int IdExploitation { get; set; }
        public string NomExploitation { get; set; }
        public string DescriptionExploitation { get; set; }
        public DateTime DateAjoutExploitation { get; set; }
        public string AdresseExploitation { get; set; }
        public int FK_IdProjet { get; set; }
        public int NombreNoeuds { get; set; }

        public List<Exploitation> GetExploitationList(int IdProjet)
        {
            List<Exploitation> exploitations = new List<Exploitation>();
            var explois = entities.exploitation.Where(x => x.FK_IdProjet == IdProjet);
            foreach (var exploi in explois)
            {
                int a = 0;
                var parcelles = entities.parcelle.Where(x => x.FK_IdExploitation == exploi.IdExploitation);
                foreach (var parcelle in parcelles)
                {
                    var secteurs = entities.secteur.Where(x => x.FK_IdParcelle == parcelle.IdParcelle);
                    foreach (var secteur in secteurs)
                    {
                        var noeuds = entities.implanter_noeud_exploitation.Where(x => x.FK_Id_secteur == secteur.IdSecteur);
                        foreach (var noeud in noeuds)
                        {
                            a++;
                        }
                    }
                }
                exploitations.Add(new Exploitation()
                {
                    IdExploitation = exploi.IdExploitation,
                    NomExploitation = exploi.NomExploitation.Trim(),
                    DescriptionExploitation = exploi.DescriptionExploitation.Trim(),
                    DateAjoutExploitation = (DateTime) exploi.DateAjoutExploitation,
                    AdresseExploitation = exploi.AdresseExploitation.Trim(),
                    FK_IdProjet = (int) exploi.FK_IdProjet,
                    NombreNoeuds = a
                });
            }
            return exploitations;
        }

    }
}
